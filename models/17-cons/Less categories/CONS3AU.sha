*THIS IS THE FILE E59418C\CONS3.TXT THAT ESTIMATES NONHOMOTHETIC LEONTIEF PREFERENCES           JULY 20, 2019
*WE DO NOT IMPOSE MONEY METRIC UTILITY SCALING IN THIS MODEL; WE SPLINE UTILITY IN THIS MODEL (2 BREAK POINTS)
*WE ESTIMATE A NORMALIZED QUADRATIC RANK 1 SUBSTITUTION MATRIX IN THIS MODEL; WE HAVE ONLY 12 CONSUMPTION CATEGORIES.
PAR 10000                   
SIZE 1000
SET NODOECHO
*READ IN CANADIAN DATA FOR 1971-2017 FOR 12 CLASSES OF PER POP CONSUMPTION FROM E59418C\CDATOUT.TXT
SMPL 1 33
FORMAT(F8.0,9F10.5)
READ YEAR P1-P6
   1985.   1.00000   1.00000   1.00000   1.00000   1.00000   1.00000
   1986.   1.08081   1.10020   1.11920   1.09374   1.07977   1.10967
   1987.   1.13579   1.18814   1.20754   1.17806   1.17292   1.17853
   1988.   1.23865   1.22683   1.31907   1.25635   1.27387   1.26678
   1989.   1.32558   1.30501   1.48947   1.32069   1.36090   1.37106
   1990.   1.36967   1.39833   1.66873   1.38248   1.42633   1.48489
   1991.   1.40268   1.45070   1.81845   1.40490   1.45540   1.58759
   1992.   1.42741   1.50054   2.18350   1.42519   1.46516   1.54918
   1993.   1.45502   1.55733   2.49074   1.41770   1.47738   1.58936
   1994.   1.49049   1.61311   2.69924   1.41868   1.48887   1.66393
   1995.   1.54037   1.70116   3.13760   1.42059   1.51323   1.73161
   1996.   1.58939   1.74321   3.28548   1.42728   1.54371   1.82523
   1997.   1.61070   1.76305   3.39283   1.42534   1.57802   1.89143
   1998.   1.68923   1.79000   3.52070   1.40910   1.60228   1.87536
   1999.   1.71227   1.79827   3.79570   1.39586   1.63085   2.07594
   2000.   1.74502   1.93044   4.30896   1.49544   1.68747   2.06298
   2001.   1.82720   1.97864   4.53981   1.48837   1.74311   2.13063
   2002.   1.89743   2.01557   4.76304   1.50712   1.79459   2.24390
   2003.   1.94634   2.09354   4.94371   1.50970   1.84362   2.29083
   2004.   1.96189   2.16553   4.95969   1.47905   1.89399   2.35732
   2005.   2.05244   2.21593   5.16277   1.45227   1.96130   2.40023
   2006.   2.19318   2.27635   5.56019   1.44119   2.04603   2.53003
   2007.   2.25464   2.35770   5.83753   1.44768   2.15454   2.58083
   2008.   2.34528   2.44708   6.07872   1.43137   2.27365   2.59126
   2009.   2.35795   2.51646   6.36500   1.43690   2.37900   2.65357
   2010.   2.39914   2.55778   7.77426   1.40696   2.46973   2.67182
   2011.   2.42596   2.60481   8.27714   1.41322   2.58303   2.69743
   2012.   2.45480   2.66604   8.86338   1.40982   2.68184   2.76157
   2013.   2.48981   2.73867   9.92116   1.40499   2.75185   2.83124
   2014.   2.55137   2.79576  11.22214   1.38082   2.78967   2.89136
   2015.   2.53452   2.85545  12.63424   1.38316   2.82103   2.97068
   2016.   2.57419   2.87728  14.05046   1.37280   2.85706   3.00560
   2017.   2.54878   2.94138  15.96832   1.32753   2.90654   3.06670

FORMAT(F8.0,9F10.5)
PRINT YEAR P1-P6 / FORMAT
READ YEAR P7-P12
   1985.   1.00000   1.00000   1.00000   1.00000   1.00000   1.00000
   1986.   1.08424   1.03444   1.08949   1.10206   1.08409   1.04944
   1987.   1.15443   1.11398   1.15056   1.21907   1.15866   1.04781
   1988.   1.19927   1.13363   1.19647   1.35726   1.22452   0.96725
   1989.   1.28507   1.12549   1.24076   1.52745   1.30888   1.06175
   1990.   1.36109   1.15619   1.28992   1.70998   1.38538   1.14946
   1991.   1.35641   1.20545   1.32519   1.85858   1.42941   1.18329
   1992.   1.36882   1.20472   1.36426   1.98486   1.46106   1.31193
   1993.   1.39495   1.19725   1.38864   2.06684   1.49214   1.34423
   1994.   1.42486   1.21382   1.40352   2.15160   1.53606   1.35071
   1995.   1.45164   1.21033   1.42192   2.30447   1.59169   1.36413
   1996.   1.44418   1.20121   1.41089   2.37941   1.60854   1.36114
   1997.   1.41503   1.20031   1.42013   2.47866   1.66413   1.43547
   1998.   1.39124   1.15632   1.41907   2.63970   1.67091   1.51944
   1999.   1.42782   1.09495   1.41496   2.72763   1.70998   1.50045
   2000.   1.48618   1.17241   1.47121   2.91442   1.81268   1.66401
   2001.   1.47081   1.17698   1.48662   2.98811   1.88349   1.71404
   2002.   1.52710   1.22432   1.47846   3.26015   1.93840   1.68485
   2003.   1.53631   1.24194   1.44805   3.39754   1.97096   1.51186
   2004.   1.56820   1.26307   1.43938   3.70491   1.99907   1.52566
   2005.   1.66477   1.26333   1.43959   3.91548   2.05497   1.55093
   2006.   1.73212   1.27041   1.44515   4.09385   2.10267   1.56737
   2007.   1.82202   1.28989   1.45472   4.24190   2.13775   1.49407
   2008.   1.74983   1.25830   1.47628   4.53150   2.25673   1.66427
   2009.   1.77618   1.25851   1.48619   4.81824   2.30786   1.45807
   2010.   1.80793   1.20437   1.46427   5.07346   2.34543   1.35583
   2011.   1.85440   1.17682   1.45380   5.35709   2.40145   1.33397
   2012.   1.86193   1.22703   1.46541   5.66292   2.48094   1.36287
   2013.   1.93594   1.11538   1.47327   5.97997   2.55240   1.51690
   2014.   1.91203   1.01520   1.49592   6.30235   2.61078   1.60683
   2015.   1.92852   0.88609   1.52077   6.59157   2.67421   1.73699
   2016.   1.93214   0.81349   1.52108   6.78731   2.72035   1.66431
   2017.   1.98128   0.78219   1.51379   6.98437   2.77835   1.68636


PRINT YEAR P7-P12 / FORMAT
READ YEAR Q1-Q6
   1985.   1.18670   0.17032   0.20084   0.57239   2.46125   0.37338
   1986.   1.16815   0.16177   0.19824   0.55793   2.48419   0.38858
   1987.   1.16774   0.16187   0.19410   0.56232   2.53347   0.39061
   1988.   1.14383   0.16078   0.19044   0.55474   2.58149   0.41480
   1989.   1.14658   0.16379   0.18703   0.54092   2.63329   0.41803
   1990.   1.13051   0.15859   0.17648   0.50819   2.60507   0.41988
   1991.   1.14362   0.15412   0.16354   0.52049   2.66215   0.42474
   1992.   1.15056   0.15619   0.15182   0.49895   2.71854   0.45114
   1993.   1.15354   0.16632   0.13890   0.49158   2.77030   0.46453
   1994.   1.19261   0.18018   0.12897   0.49630   2.83456   0.46050
   1995.   1.20789   0.17588   0.11855   0.51209   2.87345   0.45611
   1996.   1.18492   0.17848   0.12032   0.51216   2.90935   0.44873
   1997.   1.21429   0.18753   0.12002   0.51757   2.97048   0.43884
   1998.   1.20315   0.19615   0.12157   0.54628   3.02911   0.47013
   1999.   1.22606   0.20611   0.11997   0.56525   3.13087   0.47065
   2000.   1.25855   0.21019   0.11447   0.56178   3.18348   0.49915
   2001.   1.28520   0.21183   0.10949   0.58188   3.25531   0.54017
   2002.   1.29738   0.21714   0.10836   0.61989   3.33650   0.56527
   2003.   1.33019   0.22020   0.10571   0.65708   3.43033   0.58755
   2004.   1.36050   0.23251   0.10700   0.70155   3.51214   0.60557
   2005.   1.37336   0.23615   0.10243   0.73895   3.53352   0.61501
   2006.   1.37697   0.24688   0.09843   0.79546   3.60863   0.64140
   2007.   1.38643   0.25352   0.09181   0.83340   3.66303   0.67173
   2008.   1.39060   0.25890   0.08767   0.85948   3.68436   0.69896
   2009.   1.39477   0.26455   0.08377   0.90146   3.72006   0.72023
   2010.   1.40568   0.27222   0.07757   0.92372   3.77186   0.74780
   2011.   1.42178   0.28026   0.07273   0.92295   3.78785   0.77608
   2012.   1.43997   0.27387   0.07000   0.93543   3.78094   0.82107
   2013.   1.46053   0.27352   0.06669   0.97659   3.80305   0.82652
   2014.   1.44636   0.27816   0.05897   0.98426   3.84832   0.84095
   2015.   1.48582   0.27648   0.05438   1.03357   3.88497   0.85112
   2016.   1.48579   0.27899   0.05035   1.04375   3.91325   0.87108
   2017.   1.52604   0.27901   0.04997   1.07038   3.93818   0.88604
PRINT YEAR Q1-Q6 / FORMAT
READ YEAR Q7-Q12
   1985.   1.27018   0.13143   0.93449   0.17063   1.82065   0.13675
   1986.   1.19728   0.13591   0.93211   0.17804   1.93771   0.13819
   1987.   1.19661   0.14119   0.97261   0.17345   1.99731   0.15832
   1988.   1.27324   0.14946   1.02506   0.18125   2.09692   0.18948
   1989.   1.34503   0.15974   1.08328   0.19312   2.15417   0.20591
   1990.   1.30589   0.16258   1.06697   0.18697   2.12726   0.18840
   1991.   1.30732   0.17604   1.09466   0.18667   2.13709   0.17198
   1992.   1.34232   0.20089   1.11449   0.18447   2.10409   0.17428
   1993.   1.34622   0.22230   1.18526   0.18817   2.07582   0.17255
   1994.   1.40580   0.24210   1.27981   0.19058   2.14383   0.19014
   1995.   1.43756   0.27682   1.36848   0.19058   2.18921   0.20900
   1996.   1.48462   0.30940   1.45314   0.19721   2.21980   0.23768
   1997.   1.60997   0.33441   1.53376   0.20381   2.33424   0.26091
   1998.   1.71600   0.37880   1.60713   0.21158   2.52153   0.29044
   1999.   1.71228   0.42740   1.66737   0.22243   2.63071   0.29518
   2000.   1.76079   0.47832   1.71152   0.22058   2.63631   0.32170
   2001.   1.77473   0.50507   1.76524   0.23286   2.62692   0.28989
   2002.   1.82471   0.53408   1.88210   0.22734   2.67623   0.29642
   2003.   1.90665   0.55479   2.01978   0.23217   2.79460   0.39618
   2004.   1.99192   0.59255   2.11042   0.23160   2.87757   0.47188
   2005.   1.97358   0.62698   2.17825   0.23890   2.98892   0.48149
   2006.   2.08183   0.63973   2.28163   0.24470   3.13716   0.53243
   2007.   2.22334   0.65237   2.39560   0.24519   3.21462   0.65718
   2008.   2.04306   0.66196   2.38247   0.25276   3.06589   0.64361
   2009.   2.08441   0.65950   2.44715   0.26735   3.11038   0.77581
   2010.   2.21446   0.69684   2.59611   0.27359   3.14620   0.89355
   2011.   2.25758   0.71625   2.69623   0.27859   3.14626   0.95233
   2012.   2.29346   0.70323   2.61503   0.28275   3.11502   0.97790
   2013.   2.23966   0.77890   2.61039   0.28518   3.18953   0.94728
   2014.   2.20252   0.86079   2.67692   0.28425   3.24710   0.87906
   2015.   2.18813   0.96742   2.69451   0.28427   3.28644   0.87605
   2016.   2.18126   1.04844   2.68162   0.28415   3.32851   0.93191
   2017.   2.17858   1.08895   2.73428   0.28587   3.37872   0.94431
PRINT YEAR Q7-Q12 / FORMAT
*1 IS THE SERIES       Food and non-alcoholic beverages
*2 IS THE SERIES       Alcoholic beverages
*3 IS THE SERIES       Tobacco
*4 IS THE SERIES       Clothing and footwear
*5 IS THE SERIES       Housing including electricity,gas and household furnishings
*6 IS THE SERIES       Health
*7 IS THE SERIES       Transportation aggregate, owned and purchased
*8 IS THE SERIES       Communications
*9 IS THE SERIES       Recreation and culture
*10 IS THE SERIES      Education
*11 IS THE SERIES      Services aggregate including Restaurants and hotels and Miscellaneous goods and services
*12 IS THE SERIES      Final consumption expenditure of resident households abroad
DO #=1,12
GENR V#=P#*Q#
ENDO

*GENR CHAINED FISHER PRICE AND QUANTITY INDEXES
INDEX P1 Q1 P2 Q2 P3 Q3 P4 Q4 P5 Q5 P6 Q6 P7 Q7 P8 Q8 P9 Q9 P10 Q10 &
P11 Q11 P12 Q12 / CHAIN FISHER=PF QFISHER=QF
*GENR EXPENDITURE Y ON THE 12 COMMODITIES
GENR Y=PF*QF
*GENR THE NORMALIZED QUADRATIC FIXED BASE AND CHAINED INDEXES
*WE FIRST NEED TO GENR FIXED WEIGHTS SUMMING TO 1,G1 TO G12. WE INITIALLY DEFINE THESE G# AS SAMPLE MEANS
DO #=1,12
STAT Q# / MEAN=GG#
ENDO
*SUM THE GG#
SMPL 1 1
GENR SUM=0
DO #=1,12
GENR SUM=SUM+GG#
ENDO
*DEFINE THE NORMALIZED GG#
DO #=1,12
GENR GG#=GG#/SUM
ENDO
FORMAT(6F10.5)
PRINT GG1-GG6 / FORMAT
PRINT GG7-GG12 / FORMAT
SMPL 1 33
GENR ONE=1
DO #=1,12
GENR G#=GG#(1)*ONE
ENDO
*GENR THE LOWE PRICE INDEX PG
GENR PG=0
DO #=1,12
GENR PG=PG+P#*G#
ENDO
*GENR PG NORMALIZED PRICES:
DO #=1,12
GENR PN#=P#/PG
ENDO
FORMAT(7F10.5)
PRINT PG PN1-PN6 / FORMAT
PRINT PG PN7-PN12 / FORMAT
STAT PG PN1-PN12

*THE EXACT INDEX NUMBER FORMULA FOR NORMALIZED QUADRATIC PREFERENCES USING A FIXED BASE IS
*u(t)/u(1)=SUM(PN#(t)+PN#(1))Q#(t)/(SUM(PN#(t)+PN#(1))Q#(1))
GENR NUM=0
GENR DEN=0
DO #=1,12
GENR NUM=NUM+(PN#+PN#(1))*Q#
GENR DEN=DEN+(PN#+PN#(1))*Q#(1)
ENDO
GENR QNFB=NUM/DEN
*NORMALIZE QNFB TO EQUAL Y IN OBSERVATION 1
GENR CON=QNFB(1)
GENR QNFB=QNFB*Y(1)/CON
GENR PNFB=Y/QNFB
*NOW CONSTRUCT THE NORMALIZED QUADRATIC CHAIN LINKS
GENR QNCH=1
GENR QNCHL=1
GENR NUML=0
GENR DENL=0
SMPL 2 33
DO #=1,12
GENR NUML=NUML+(PN#+LAG(PN#))*Q#
GENR DENL=DENL+(PN#+LAG(PN#))*LAG(Q#)
ENDO
*NOW CONSTRUCT THE NORMALIZED QUADRATIC EXACT INDEX NUMBER FORMULA USING THE CHAIN PRINCIPLE
GENR QNCHL=NUML/DENL
GENR QNCH=LAG(QNCH)*QNCHL
*NORMALIZE QNCH TO EQUAL Y AT OBSERVATION 1
SMPL 1 33
GENR CON=QNCH(1)
GENR QNCH=QNCH*Y(1)/CON
GENR PNCH=Y/QNCH
FORMAT(F8.0,7F10.5)
PRINT YEAR QF QNCH QNFB PF PNCH PNFB Y / FORMAT
*THE CHAINED FISHER AND CHAINED NORMALIZED QUADRATIC INDEXES DIFFER ONLY IN THE 4TH AND 5TH DECIMAL PLACE
*THEY ARE INCREDIBLY CLOSE!

GENR U=QNCH
*IN THIS RUN, WE WILL SPLINE UTILITY AT 2 BREAK POINTS 13 AND 17
GENR U=QNCH
*WE WILL SPLINE UTILITY AT OBS 13 AND 17
DO #=1,3
GENR U#=0
ENDO
GENR U1=U
SMPL 14 33
GENR U1=U1(13)
GENR U2=U-U(13)
SMPL 18 33
GENR U2=U2(17)
GENR U3=U-U(17)
SMPL 1 33
GENR CHECK=U-U1-U2-U3
STAT CHECK
*CHECK SHOULD BE 0 FOR ALL OBSERVATIONS AND THIS CHECK IS SATISFIED

*CHANGE NOTATION FOR NORMALIZED PRICES; CALL THEM V# INSTEAD OF PN#
DO #=1,12
GENR V#=PN#
ENDO

*GENR DIFFERENCES OF NORMALIZED PRICES WITH THE FIRST NORMALIZED INPUT PRICE
DO #=1,12
GENR V1D#=V#-V1
ENDO
*NOTE: IN THE DESCRIPTIONS BELOW, I SOMETIMES REFER TO 
*OUR NQ UNIT COST FUNCTION WITH A RANK ONE SUBSTITUTION MATRIX IS EQUAL TO C(u,p) DEFINED AS FOLLOWS:
*C(u,p) = a.p + bA.pU1 + bB.pU2 + bC.pU3 - (1/2)(p.c)(p.c)U/p.g WHERE c.1 = 0.
*WE SET c(1) = -SUM(n=2,12)c(n). THEREFORE c.v = SUM(n=2,12)c(n)(v(n)-v(1)) = SUM(n=2,12)c(n)V1D#
*THE HICKSIAN DEMAND FUNCTIONS ARE AS FOLLOWS
*q = a + bA*U1 + bB*U2 + bC*U3- c(c.v)*U + (1/2)g(c.v)(c.v)*U 
   
*WE USE THE FINAL COEFS FROM CONS2OUT.TXT AS STARTING VALUES IN THE FOLLOWING REGRESSION
*HOWEVER, SHAZAM ROUNDS OFF THE STARTING VALUES AND IN SOME CASES, GREATLY CHANGES THE STARTING COEFS
*THIS EXPLAINS WHY THE STARTING LL MAY NOT BE EQUAL TO THE FINISHING LL IN THE PREVIOUS RUN.
*WE WILL NOW RUN A SYSTEM REGRESSION WITH UTILITY SPLINES WITH A RANK 1 SUBSTITUTION MATRIX
 
NL 12 / NCOEF=59 GENRVAR CONV=.000001 ITER=2000 PITER=50 LIST
EQ Q1=A1+BA1*U1+BB1*U2+BC1*U3 &
+(C2+C3+C4+C5+C6+C7+C8+C9+C10+C11+C12)*(C2*V1D2 &
+C3*V1D3+C4*V1D4+C5*V1D5+C6*V1D6+C7*V1D7+C8*V1D8+C9*V1D9+C10*V1D10+C11*V1D11+C12*V1D12)*U &
+(1/2)*G1*((C2*V1D2+C3*V1D3+C4*V1D4+C5*V1D5+C6*V1D6+C7*V1D7+C8*V1D8+C9*V1D9+C10*V1D10+C11*V1D11+C12*V1D12)**2)*U 
EQ Q2=A2+BA2*U1+BB2*U2+BC2*U3 &
-C2*(C2*V1D2+C3*V1D3+C4*V1D4+C5*V1D5+C6*V1D6+C7*V1D7+C8*V1D8+C9*V1D9+C10*V1D10+C11*V1D11+C12*V1D12)*U &
+(1/2)*G2*((C2*V1D2+C3*V1D3+C4*V1D4+C5*V1D5+C6*V1D6+C7*V1D7+C8*V1D8+C9*V1D9+C10*V1D10+C11*V1D11+C12*V1D12)**2)*U 
EQ Q3=A3+BA3*U1+BB3*U2+BC3*U3 &
-C3*(C2*V1D2+C3*V1D3+C4*V1D4+C5*V1D5+C6*V1D6+C7*V1D7+C8*V1D8+C9*V1D9+C10*V1D10+C11*V1D11+C12*V1D12)*U &
+(1/2)*G3*(C2*V1D2+C3*V1D3+C4*V1D4+C5*V1D5+C6*V1D6+C7*V1D7+C8*V1D8+C9*V1D9+C10*V1D10+C11*V1D11+C12*V1D12)*U 
EQ Q4=A4+BA4*U1+BB4*U2+BC4*U3 &
-C4*(C2*V1D2+C3*V1D3+C4*V1D4+C5*V1D5+C6*V1D6+C7*V1D7+C8*V1D8+C9*V1D9+C10*V1D10+C11*V1D11+C12*V1D12)*U &
+(1/2)*G4*((C2*V1D2+C3*V1D3+C4*V1D4+C5*V1D5+C6*V1D6+C7*V1D7+C8*V1D8+C9*V1D9+C10*V1D10+C11*V1D11+C12*V1D12)**2)*U 
EQ Q5=A5+BA5*U1+BB5*U2+BC5*U3 &
-C5*(C2*V1D2+C3*V1D3+C4*V1D4+C5*V1D5+C6*V1D6+C7*V1D7+C8*V1D8+C9*V1D9+C10*V1D10+C11*V1D11+C12*V1D12)*U &
+(1/2)*G5*((C2*V1D2+C3*V1D3+C4*V1D4+C5*V1D5+C6*V1D6+C7*V1D7+C8*V1D8+C9*V1D9+C10*V1D10+C11*V1D11+C12*V1D12)**2)*U 
EQ Q6=A6+BA6*U1+BB6*U2+BC6*U3 &
-C6*(C2*V1D2+C3*V1D3+C4*V1D4+C5*V1D5+C6*V1D6+C7*V1D7+C8*V1D8+C9*V1D9+C10*V1D10+C11*V1D11+C12*V1D12)*U &
+(1/2)*G6*((C2*V1D2+C3*V1D3+C4*V1D4+C5*V1D5+C6*V1D6+C7*V1D7+C8*V1D8+C9*V1D9+C10*V1D10+C11*V1D11+C12*V1D12)**2)*U
EQ Q7=A7+BA7*U1+BB7*U2+BC7*U3 &
-C7*(C2*V1D2+C3*V1D3+C4*V1D4+C5*V1D5+C6*V1D6+C7*V1D7+C8*V1D8+C9*V1D9+C10*V1D10+C11*V1D11+C12*V1D12)*U &
+(1/2)*G7*((C2*V1D2+C3*V1D3+C4*V1D4+C5*V1D5+C6*V1D6+C7*V1D7+C8*V1D8+C9*V1D9+C10*V1D10+C11*V1D11+C12*V1D12)**2)*U
EQ Q8=A8+BA8*U1+BB8*U2+BC8*U3 &
-C8*(C2*V1D2+C3*V1D3+C4*V1D4+C5*V1D5+C6*V1D6+C7*V1D7+C8*V1D8+C9*V1D9+C10*V1D10+C11*V1D11+C12*V1D12)*U &
+(1/2)*G8*((C2*V1D2+C3*V1D3+C4*V1D4+C5*V1D5+C6*V1D6+C7*V1D7+C8*V1D8+C9*V1D9+C10*V1D10+C11*V1D11+C12*V1D12)**2)*U
EQ Q9=A9+BA9*U1+BB9*U2+BC9*U3 &
-C9*(C2*V1D2+C3*V1D3+C4*V1D4+C5*V1D5+C6*V1D6+C7*V1D7+C8*V1D8+C9*V1D9+C10*V1D10+C11*V1D11+C12*V1D12)*U &
+(1/2)*G9*((C2*V1D2+C3*V1D3+C4*V1D4+C5*V1D5+C6*V1D6+C7*V1D7+C8*V1D8+C9*V1D9+C10*V1D10+C11*V1D11+C12*V1D12)**2)*U
EQ Q10=A10+BA10*U1+BB10*U2+BC10*U3 &
-C10*(C2*V1D2+C3*V1D3+C4*V1D4+C5*V1D5+C6*V1D6+C7*V1D7+C8*V1D8+C9*V1D9+C10*V1D10+C11*V1D11+C12*V1D12)*U &
+(1/2)*G10*((C2*V1D2+C3*V1D3+C4*V1D4+C5*V1D5+C6*V1D6+C7*V1D7+C8*V1D8+C9*V1D9+C10*V1D10+C11*V1D11+C12*V1D12)**2)*U
EQ Q11=A11+BA11*U1+BB11*U2+BC11*U3 &
-C11*(C2*V1D2+C3*V1D3+C4*V1D4+C5*V1D5+C6*V1D6+C7*V1D7+C8*V1D8+C9*V1D9+C10*V1D10+C11*V1D11+C12*V1D12)*U &
+(1/2)*G11*((C2*V1D2+C3*V1D3+C4*V1D4+C5*V1D5+C6*V1D6+C7*V1D7+C8*V1D8+C9*V1D9+C10*V1D10+C11*V1D11+C12*V1D12)**2)*U
EQ Q12=A12+BA12*U1+BB12*U2+BC12*U3 &
-C12*(C2*V1D2+C3*V1D3+C4*V1D4+C5*V1D5+C6*V1D6+C7*V1D7+C8*V1D8+C9*V1D9+C10*V1D10+C11*V1D11+C12*V1D12)*U &
+(1/2)*G12*((C2*V1D2+C3*V1D3+C4*V1D4+C5*V1D5+C6*V1D6+C7*V1D7+C8*V1D8+C9*V1D9+C10*V1D10+C11*V1D11+C12*V1D12)**2)*U
COEF A1       0.97491 
COEF BA1      0.018677 
COEF BB1      0.058709 
COEF BC1      0.048788 
COEF A2       0.038165 
COEF BA2      0.012577 
COEF BB2      0.019714 
COEF BC2      0.016978 
COEF A3       0.61544 
COEF BA3     -0.044140 
COEF BB3      0.013519 
COEF BC3     -0.014960 
COEF A4       0.75569 
COEF BA4     -0.022113 
COEF BB4      0.048740 
COEF BC4      0.10920 
COEF A5       0.26237 
COEF BA5      0.23598 
COEF BB5      0.18608 
COEF BC5      0.15579 
COEF A6       0.097361 
COEF BA6      0.031950 
COEF BB6      0.021550 
COEF BC6      0.083403 
COEF A7      -0.48001 
COEF BA7      0.17777 
COEF BB7      0.16617 
COEF BC7      0.10784 
COEF A8      -0.88254 
COEF BA8      0.10559 
COEF BB8      0.077732 
COEF BC8      0.10358 
COEF A9       -1.8646 
COEF BA9      0.29346 
COEF BB9      0.17228 
COEF BC9      0.23204 
COEF A10      0.042399 
COEF BA10     0.014032 
COEF BB10     0.010945 
COEF BC10     0.015319 
COEF A11      0.14073 
COEF BA11     0.19101 
COEF BB11     0.23747 
COEF BC11     0.14980 
COEF A12     -0.43616 
COEF BA12     0.060861 
COEF BB12    -0.010422 
COEF BC12     0.16880     
COEF C2 0.001
COEF C3 0.001
COEF C4 0.001
COEF C5 0.001
COEF C6 0.001
COEF C7 0.001
COEF C8 0.001
COEF C9 0.001
COEF C10 0.001
COEF C11 0.001
COEF C12 0.001

END
* FINAL LOG-LIKELIHOOD   = 1185.833, 
*FOR SOME EQUATIONS, THE FIT IS GOOD; FOR SOME EQUATIONS IT IS NOT SO GOOD.WE ARE CAPTURING THE GENERAL TRENDS PRETTY WELL.

*WE NEED TO GENR THE MATRIX OF SECOND ORDER PARTIAL DERIVATIVES OF THE COST FUNCTION WRT PRICES
*FIRST GENR THE C VECTOR AND THEN C TIMES C TRANSPOSE = THE C MATRIX = CC#$
SMPL 1 1
*GENR THE FIRST COMPONENT OF THE C VECTOR
GENR C1=0
DO #=2,12
GENR C1=C1-C#(1)
ENDO
SMPL 1 33
*GENR INNER PRODUCT OF C VECTOR WITH NORMALIZED PRICE VECTOR V
GENR CV=0
DO #=1,12
GENR CV=CV+C#(1)*V#
ENDO

*GENR V TRANSPOSE TIMES THE C VECTOR SQUARED = CV*CV
GENR VCV=CV*CV
*GENR FITTED DEMAND FUNCTIONS
DO #= 1,12
GENR FQ#=A#(1)+BA#(1)*U1+BB#(1)*U2+BC#(1)*U3-C#(1)*CV*U+.5*G#*VCV*U
ENDO
*COMPARE FITTED DEMANDS WITH ACTUAL DEMANDS
FORMAT(F8.0,12F8.4)
PRINT YEAR Q1 FQ1 Q2 FQ2 Q3 FQ3 Q4 FQ4 Q5 FQ5 Q6 FQ6 / FORMAT
PRINT YEAR Q7 FQ7 Q8 FQ8 Q9 FQ9 Q10 FQ10  Q11 FQ11 Q12 FQ12 / FORMAT
STAT Q1 FQ1 Q2 FQ2 Q3 FQ3 Q4 FQ4 Q5 FQ5 Q6 FQ6 Q7 FQ7 Q8 FQ8 Q9 FQ9 Q10 FQ10 Q11 FQ11 Q12 FQ12
* NAME         N   MEAN        ST. DEV     VARIANCE     MINIMUM      MAXIMUM
* Q1           33   1.2953     0.12534     0.15711E-01   1.1305       1.5260
* FQ1          33   1.2953     0.12461     0.15527E-01   1.1387       1.5088
* Q2           33  0.21644     0.46508E-01 0.21629E-02  0.15412      0.28026
* FQ2          33  0.21644     0.46311E-01 0.21447E-02  0.16267      0.28305
* Q3           33  0.11638     0.45225E-01 0.20453E-02  0.49970E-01  0.20084
* FQ3          33  0.11890     0.42162E-01 0.17776E-02  0.58276E-01  0.20786
* Q4           33  0.69996     0.19817     0.39273E-01  0.49158       1.0704
* FQ4          33  0.69996     0.19697     0.38796E-01  0.48909       1.0700
* Q5           33   3.2380     0.50363     0.25364       2.4613       3.9382
* FQ5          33   3.2380     0.50296     0.25297       2.4560       3.9326
* Q6           33  0.58353     0.16776     0.28143E-01  0.37338      0.88604
* FQ6          33  0.58353     0.16682     0.27829E-01  0.38068      0.90577
* Q7           33   1.7688     0.38320     0.14684       1.1966       2.2935
* FQ7          33   1.7688     0.38100     0.14516       1.2036       2.2324
* Q8           33  0.49135     0.28192     0.79482E-01  0.13143       1.0890
* FQ8          33  0.49135     0.28196     0.79500E-01  0.11378       1.0563
* Q9           33   1.8424     0.64839     0.42041      0.93211       2.7343
* FQ9          33   1.8424     0.64760     0.41939      0.90773       2.7374
* Q10          33  0.22761     0.39674E-01 0.15740E-02  0.17063      0.28587
* FQ10         33  0.22761     0.39353E-01 0.15487E-02  0.17273      0.29546
* Q11          33   2.6502     0.49969     0.24969       1.8207       3.3787
* FQ11         33   2.6502     0.49675     0.24676       1.9058       3.3374
* Q12          33  0.46328     0.30808     0.94915E-01  0.13675      0.97790
* FQ12         33  0.46328     0.30558     0.93378E-01  0.13281      0.97984
*THE AVERAGE FITTED DEMAND COINCIDES WITH THE CORRESPONDING AVERAGE ACTUAL DEMAND FOR EVERY COMMODITY EXCEPT Q3; SURPRISING!

*GENR THE COMPONENTS OF THE EXPENDITURE FUNCTION THAT IS IMPLIED BY OUR ESTIMATES
*GENR A.P , BA.P  BB.P  BC.P 
GENR AP=0
GENR BAP=0
GENR BBP=0
GENR BCP=0
DO #=1,12
GENR AP=AP+P#*A#
GENR BAP=BAP+P#*BA#
GENR BBP=BBP+P#*BB#
GENR BCP=BCP+P#*BC#
ENDO
*GENR THE INDIRECT UTILITY FUNCTION THAT CORRESPONDS TO OUR ESTIMATED COEFS
GENR IU=0
SMPL 1 13
GENR IU=(Y-AP)/(BAP-.5*PG*VCV)
SMPL 14 17
GENR IU=(Y-AP-BAP*IU(13)+BBP*IU(13))/(BBP-.5*PG*VCV)
SMPL 18 33
GENR IU=(Y-AP-BAP*IU(13)-BBP*(IU(17)-IU(13))+BCP*IU(17))/(BCP-.5*PG*VCV)
SMPL 1 33
FORMAT(F8.0,8F10.5)
PRINT YEAR U IU AP BAP BBP BCP VCV Y / FORMAT
STAT U IU / PCOR
* NAME         N    MEAN        ST. DEV     VARIANCE     MINIMUM      MAXIMUM
* U            33   13.450      3.0055      9.0330       9.4290       18.047
* IU           33   13.447      3.0057      9.0345       9.4349       18.027
*  CORRELATION MATRIX OF VARIABLES -       33 OBSERVATIONS
* U          1.0000
* IU         1.0000       1.0000
*              U            IU
*U AND IU APPROXIMATE EACH OTHER VERY CLOSELY NOW

OLS U IU / LIST
*    OBS.   OBSERVED     PREDICTED   CALCULATED
*      NO.    VALUE        VALUE       RESIDUAL
*       1    9.4290       9.4383     -0.92420E-02          *     I
*       2    9.4779       9.4851     -0.72484E-02           *    I
*       3    9.6482       9.6484     -0.25499E-03                *
*       4    9.9526       9.9466      0.59856E-02                I   *
*       5    10.216       10.210      0.60383E-02                I   *
*       6    10.018       10.015      0.30552E-02                I *
*       7    10.127       10.127      0.28294E-03                *
*       8    10.214       10.216     -0.19106E-02               *I
*       9    10.330       10.331     -0.10715E-02               *I
*      10    10.685       10.684      0.14811E-02                I*
*      11    10.946       10.943      0.36111E-02                I *
*      12    11.170       11.165      0.49951E-02                I  *
*      13    11.619       11.611      0.76799E-02                I    *
*      14    12.176       12.166      0.10244E-01                I     *
*      15    12.559       12.553      0.57123E-02                I   *
*      16    12.802       12.797      0.51367E-02                I  *
*      17    13.026       13.022      0.36759E-02                I *
*      18    13.421       13.422     -0.52261E-03                *
*      19    14.051       14.061     -0.10388E-01         *      I
*      20    14.590       14.613     -0.23049E-01  *             I
*      21    14.904       14.921     -0.16636E-01      *         I
*      22    15.514       15.520     -0.59494E-02            *   I
*      23    16.074       16.078     -0.36661E-02              * I
*      24    15.865       15.872     -0.65510E-02            *   I
*      25    16.272       16.276     -0.34749E-02              * I
*      26    16.771       16.773     -0.21949E-02               *I
*      27    16.980       16.980      0.29609E-03                *
*      28    17.002       16.999      0.32731E-02                I *
*      29    17.208       17.209     -0.14383E-02               *I
*      30    17.336       17.337     -0.10081E-02               *I
*      31    17.624       17.618      0.63025E-02                I   *
*      32    17.793       17.784      0.98763E-02                I     *
*      33    18.047       18.030      0.16960E-01                I          *
* DURBIN-WATSON = 0.3933    VON NEUMANN RATIO = 0.4056    RHO =  0.82991
* RESIDUAL SUM =  0.42244E-13  RESIDUAL VARIANCE =  0.63380E-04
* SUM OF ABSOLUTE ERRORS=  0.18921
* R-SQUARE BETWEEN OBSERVED AND PREDICTED = 1.0000


*CHECK OUR COMPUTATIONS
*GENR FITTED Y
SMPL 1 33
GENR FY=0
DO #=1,12
GENR FY=FY+P#*FQ#
ENDO
*GENR THE INDIRECT UTILITY THAT CORRESPONDS TO FY, NEWU OR NU
GENR NU=0
SMPL 1 13
GENR NU=(FY-AP)/(BAP-.5*PG*VCV)
SMPL 14 17
GENR NU=(FY-AP-BAP*NU(13)+BBP*NU(13))/(BBP-.5*PG*VCV)
SMPL 18 33
GENR NU=(FY-AP-BAP*NU(13)-BBP*(NU(17)-NU(13))+BCP*NU(17))/(BCP-.5*PG*VCV)
SMPL 1 33
FORMAT(F8.0,10F10.5)
PRINT YEAR IU NU U AP BAP BBP BCP VCV FY Y / FORMAT
*U IS INDEX NUMBER U; IU IS THE INDIRECT U THAT IS GENERATED BY OUR REGRESSION; NU IS THE INDIRECT U THAT
*IS GENERATED BY OUR REGRESSION BUT USES FITTED EXPENDITURES TO GENERATE THE INDIRECT UTILITY FUNCTION
*NU AND U SHOULD COINCIDE AND THEY DO
STAT IU NU U / PCOR
* NAME         N    MEAN        ST. DEV     VARIANCE     MINIMUM      MAXIMUM
* IU           33   13.447      3.0057      9.0345       9.4349       18.027
* NU           33   13.450      3.0055      9.0330       9.4290       18.047
* U            33   13.450      3.0055      9.0330       9.4290       18.047
*  CORRELATION MATRIX OF VARIABLES -       33 OBSERVATIONS
* IU         1.0000
* NU         1.0000       1.0000
* U          1.0000       1.0000       1.0000
*              IU           NU           U
*IF THE FIT IN OUR ESTIMATING EQUATIONS IS GOOD, THEN OUR METHOD WORKS WELL.

*FINISH UP BY GENERATING ELASTICITIES
*GENR THE MATRIX OF SECOND ORDER PARTIAL DERIVATIVES OF THE COST FUNCTION WRT INPUT PRICES
DO #=1,12
DO $=1,12
GENR D#C$=(-C#(1)*C$(1)+C#(1)*G$*CV+G#*C$(1)*CV-G#*G$*VCV)*U/PG
ENDO
ENDO

*CALCULATE THE MATRIX OF ORDINARY PRICE ELASTICITIES OF INPUT DEMAND FOR EACH YEAR
DO #=1,12
DO $=1,12
GENR E#P$=D#C$*P$/FQ#
ENDO
ENDO

DO #=1,12
GENR CHECK#=E#P1+E#P2+E#P3+E#P4+E#P5+E#P6+E#P7+E#P8+E#P9+E#P10+E#P11+E#P12
ENDO
STAT CHECK1-CHECK12
*ALL CHECK# ARE 0; CHECKS ARE SATISFIED
*PRINT OUT THE OWN ELASTICITIES OF DEMAND; THEY SHOULD ALL BE NEGATIVE (OR 0)
FORMAT(F8.0,6F10.5)
PRINT YEAR E1P1 E2P2 E3P3 E4P4 E5P5 E6P6 / FORMAT
PRINT YEAR E7P7 E8P8 E9P9 E10P10 E11P11 E12P12 / FORMAT
STAT E1P1 E2P2 E3P3 E4P4 E5P5 E6P6 E7P7 E8P8 E9P9 E10P10 E11P11 E12P12
* NAME         N    MEAN        ST. DEV     VARIANCE     MINIMUM      MAXIMUM
* E1P1         33 -0.26654     0.42706E-01 0.18238E-02 -0.32033     -0.20336
* E2P2         33 -0.12451E-02 0.94737E-04 0.89750E-08 -0.14412E-02 -0.10194E-02
* E3P3         33 -0.11911E-02 0.10485E-02 0.10993E-05 -0.38334E-02 -0.14126E-03
* E4P4         33 -0.41376E-03 0.17190E-03 0.29550E-07 -0.70071E-03 -0.99525E-04
* E5P5         33 -0.28101E-01 0.51687E-02 0.26716E-04 -0.38877E-01 -0.22885E-01
* E6P6         33 -0.26100     0.24211E-01 0.58616E-03 -0.31812     -0.22526
* E7P7         33 -0.25996E-02 0.57866E-03 0.33484E-06 -0.35045E-02 -0.14573E-02
* E8P8         33 -0.32992E-01 0.25330E-01 0.64160E-03 -0.10116     -0.67088E-02
* E9P9         33 -0.10960     0.34618E-01 0.11984E-02 -0.17702     -0.67771E-01
* E10P10       33 -0.93992E-02 0.34777E-02 0.12094E-04 -0.15972E-01 -0.45207E-02
* E11P11       33  -1.0476     0.49026E-01 0.24036E-02  -1.1428     -0.97408
* E12P12       33 -0.62014E-01 0.32299E-01 0.10432E-02 -0.12546     -0.21738E-01
*THE ONLY 4 COMMODITY CLASSES THAT HAVE AN AVERAGE OWN ELASTICITY OF DEMAND GREATER THAN 0.1 IN MAGNITUDE ARE
* E8P8       Communications
* E12P12     Final consumption expenditure of resident households abroad
* THESE TWO MAKE SENSE HAS HAVING HIGH ELASTICITIES, ALTHOUGH THE COMMUNICATIONS ONE SUSPICIOUSLY HIGH.
*MOST OF THE ELASTICITIES ARE QUITE SMALL IN MAGNITUDE. THEY WILL INCREASE AS WE ADD MORE COLUMNS TO THE MODEL


*GENR INCOME ELASTICITIES OF DEMAND
DO #=1,12
GENR EU#=0
ENDO
SMPL 1 13
DO #=1,12
GENR EU#=(BA#(1)-C#(1)*CV+.5*G#*VCV)*U/FQ#
ENDO
SMPL 14 17
DO #=1,12
GENR EU#=(BB#(1)-C#(1)*CV+.5*G#*VCV)*U/FQ#
ENDO
SMPL 18 33
DO #=1,12
GENR EU#=(BC#(1)-C#(1)*CV+.5*G#*VCV)*U/FQ#
ENDO
SMPL 1 33
FORMAT(F8.0,6F10.4)
PRINT YEAR EU1-EU6 / FORMAT
PRINT YEAR EU7-EU12 / FORMAT
STAT EU1-EU12
* NAME         N    MEAN       ST. DEV     VARIANCE     MINIMUM      MAXIMUM
* EU1          33  0.32218     0.16151     0.26086E-01  0.13748      0.64469
* EU2          33  0.96515     0.16416     0.26947E-01  0.75894       1.2225
* EU3          33  -2.5765      1.7322      3.0004      -4.9371       1.4820
* EU4          33  0.93463      1.1586      1.3424     -0.51306       2.4128
* EU5          33  0.75154     0.12666     0.16042E-01  0.59231      0.90981
* EU6          33   1.1527     0.46054     0.21209      0.60673       1.8241
* EU7          33   1.0770     0.26089     0.68064E-01  0.79212       1.4026
* EU8          33   3.6924      2.0125      4.0500       2.0591       8.8322
* EU9          33   1.8932     0.63561     0.40400       1.2820       3.0522
* EU10         33  0.80152     0.73662E-01 0.54261E-02  0.64359      0.87851
* EU11         33  0.97821     0.46122E-01 0.21273E-02  0.94935       1.1017
* EU12         33   3.1138      1.5760      2.4838     -0.47756       6.8361


*1 IS THE SERIES       Food and non-alcoholic beverages
*2 IS THE SERIES       Alcoholic beverages
*3 IS THE SERIES       Tobacco
*4 IS THE SERIES       Clothing and footwear
*5 IS THE SERIES       Housing including electricity,gas and household furnishings
*6 IS THE SERIES       Health
*7 IS THE SERIES       Transportation aggregate, owned and purchased
*8 IS THE SERIES       Communications
*9 IS THE SERIES       Recreation and culture
*10 IS THE SERIES      Education
*11 IS THE SERIES      Services aggregate including Restaurants and hotels and Miscellaneous goods and services
*12 IS THE SERIES      Final consumption expenditure of resident households abroad
STOP















